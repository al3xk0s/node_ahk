"use strict";var Ee=Object.create;var A=Object.defineProperty;var Ae=Object.getOwnPropertyDescriptor;var Le=Object.getOwnPropertyNames;var ke=Object.getPrototypeOf,Oe=Object.prototype.hasOwnProperty;var Ue=(e,t)=>{for(var o in t)A(e,o,{get:t[o],enumerable:!0})},Y=(e,t,o,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of Le(t))!Oe.call(e,s)&&s!==o&&A(e,s,{get:()=>t[s],enumerable:!(r=Ae(t,s))||r.enumerable});return e};var Z=(e,t,o)=>(o=e!=null?Ee(ke(e)):{},Y(t||!e||!e.__esModule?A(o,"default",{value:e,enumerable:!0}):o,e)),Ce=e=>Y(A({},"__esModule",{value:!0}),e);var He={};Ue(He,{BoolState:()=>h,BoolStateCompose:()=>ie,Cast:()=>ee,Cursor:()=>Se,DisposeWrapper:()=>v,DocUtils:()=>f,Key:()=>Ke,KeysSequence:()=>xe,MouseKey:()=>he,Observable:()=>S,PromiseUtils:()=>I,Queue:()=>L,Rx:()=>C,ScrollDirection:()=>R,ScrollKey:()=>Te,StringUtils:()=>k,SuchKey:()=>_,SuchMouseKey:()=>H,combineDisposers:()=>j,combineListeners:()=>x,combineScriptsWithDoc:()=>ae,createTimer:()=>te,createTimerSequence:()=>oe,force:()=>w,getHoldKey:()=>be,getTapKey:()=>ge,getTickByHold:()=>Ie,getTickKey:()=>Pe,holdKey:()=>z,inOfAny:()=>P,runScript:()=>le,runScripts:()=>q,sleep:()=>g.sleep,stream:()=>b,tapKey:()=>J,tickKey:()=>X,toDisposer:()=>M,toListener:()=>m,toggleStateByTap:()=>N,whileNeed:()=>De,whileNeedAsync:()=>we,wrapToScriptWithDoc:()=>T});module.exports=Ce(He);var ee=(e,t,o)=>({match:t,typeName:o,cast:()=>{if(!t(e))throw new Error(`Value ${e} is not type ${o}`);return e},tryCast:()=>{if(t(e))return e}});var w=e=>{if(e==null)throw new Error("Value is not exist");return e},P=(e,t)=>{try{return e in t}catch{return!1}};var b=e=>{let t=typeof e!="function"?()=>e:e;return{forEach(o){let r=0;for(let s of t())o(s,r),r++;return this},map:o=>b(function*(){let s=0;for(let n of t())yield o(n,s),s++}),filter:o=>b(function*(){let s=0;for(let n of t())o(n,s)&&(yield n),s++}),get count(){let o=0;for(let r of t())o++;return o},toArray:()=>{let o=[];for(let r of t())o.push(r);return o},get first(){return w(this.firstOrNull)},get last(){return w(this.lastOrNull)},get firstOrNull(){for(let o of t())return o},get lastOrNull(){let o;for(let r of t())o=r;return o}}};var L=class e{static from(t){let o=new e;for(let r of t)o.push(r);return o}pop(){if(this.isEmpty)return;let t=this._head;return this._head=t?.next,this._head==null&&(this._tail=void 0),t?.value}*popAll(){let t;for(;;){if(t=this.pop(),t==null)return;yield t}}push(t){let o={value:t};if(this.isEmpty){this._tail=o,this._head=this._tail;return}this._tail.next=o,this._tail=o}get isEmpty(){return this._head==null||this._tail==null}get canPop(){return!this.isEmpty}get length(){return this.isEmpty?0:b(this.toArray()).count}*toArray(){let t=this._head;for(;t!=null;)yield t.value,t=t.next}stream(){return b(this.toArray())}};var k=class{constructor(){}static{this.toTitleCase=t=>t.split(" ").filter(o=>o!=null&&o!=="").map(o=>o.substring(0,1).toUpperCase()+o.substring(1)).join(" ")}};var I=class{constructor(){}static{this.delayed=(t,o)=>new Promise(r=>{setTimeout(()=>o!=null?r(o()):r(void 0),t)})}static{this.microtask=t=>this.delayed(0,t)}};var te=({durationMs:e,onStart:t,onStop:o})=>{let r,s,n,l=()=>{r!=null&&(clearTimeout(r),r=null,n=void 0,s?.())};return{start:()=>(l(),t?.(),n=new Promise(i=>{s=i}).then(()=>o?.()),r=setTimeout(()=>{l()},e),n),stop:l}},oe=({onStart:e,onStop:t},...o)=>{let r,s=!0,n=()=>{s||(r?.stop(),s=!0)},l=async()=>{n(),s=!1,e?.();for(let i of o){if(s)break;r=i,await r.start()}n()};return{start:async()=>{await l(),t?.()},stop:n}};var re=Z(require("crypto")),U=new Uint8Array(256),O=U.length;function $(){return O>U.length-16&&(re.default.randomFillSync(U),O=0),U.slice(O,O+=16)}var d=[];for(let e=0;e<256;++e)d.push((e+256).toString(16).slice(1));function se(e,t=0){return d[e[t+0]]+d[e[t+1]]+d[e[t+2]]+d[e[t+3]]+"-"+d[e[t+4]]+d[e[t+5]]+"-"+d[e[t+6]]+d[e[t+7]]+"-"+d[e[t+8]]+d[e[t+9]]+"-"+d[e[t+10]]+d[e[t+11]]+d[e[t+12]]+d[e[t+13]]+d[e[t+14]]+d[e[t+15]]}var ne=Z(require("crypto")),V={randomUUID:ne.default.randomUUID};function Be(e,t,o){if(V.randomUUID&&!t&&!e)return V.randomUUID();e=e||{};let r=e.random||(e.rng||$)();if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,t){o=o||0;for(let s=0;s<16;++s)t[o+s]=r[s];return t}return se(r)}var F=Be;var S=()=>{let e=new Map;return{listen:t=>{let o=F();return e.set(o,t),()=>e.delete(o)},notify:t=>{for(let o of e.values())o(t)},dispose:()=>e.clear()}},v=()=>{let e=[],t=o=>e.push(o);return{addDisposer:t,addDisposers:o=>o.forEach(t),dispose:()=>e=[]}};var C=(e,{comparer:t=(r,s)=>r===s,forceUpdate:o=!1}={})=>{let r=e,s=S();return{get value(){return r},setValue:(n,{forceUpdate:l=o}={})=>{let p=r;if(r=n,l||!t(p,n))return s.notify(r)},listen:s.listen,dispose:s.dispose}};var h=(e=!1,t={})=>{let o=C(e,t),r=()=>o.setValue(!o.value),s=()=>o.setValue(!0),n=()=>o.setValue(!1);return{get value(){return o.value},get isEnabled(){return o.value},setValue:o.setValue,dispose:o.dispose,listen:o.listen,toggle:r,enable:s,disable:n}},ie={onlyOneActive:(...e)=>{let t=v();for(let o=0;o<e.length;o++){let r=e[o],s=[];for(let n=0;n<e.length;n++)o!=n&&s.push(e[n]);t.addDisposer(r.listen(n=>n&&s.forEach(l=>l.disable())))}return t}};var f=(()=>{let e=a=>`activate ${a.toString()}`,t=a=>`tap ${a.toString()}`,o=a=>`hold ${a.toString()}`,r=a=>`tick ${a.toString()}`,s=({when:a,then:y})=>`When ${e(a)}, then ${o(y)}`,n=({when:a,then:y})=>`When ${t(a)}, then ${t(y)}`,l=({when:a,then:y})=>`When ${e(a)}, then ${r(y)}`,p=a=>P("doc",a),i=a=>{if(typeof a=="string")return[a];if(Array.isArray(a))return a.map(y=>i(y)).reduce((y,E)=>[...y,...E]);if(p(a))return i(a.doc);throw Error(`Value ${a} int't doc`)},c=a=>i(a).map(y=>y).join(`
`);return{holdKey:s,tapKey:n,tickKey:l,toStringArray:i,join:c,print:a=>console.log(c(a)),activate:e,tap:t,tick:r,hold:o,isWithDoc:p}})();var B=require("suchibot"),_=(()=>{let e={...B.Key};return delete e.PAGE_UP,delete e.NUM_LOCK,e})(),H=B.MouseButton;var M=e=>typeof e=="function"?()=>void e():P("stop",e)?()=>e.stop():()=>{},m=e=>({stop:M(e)}),j=e=>{let t=v();return t.addDisposers(e),M(t.dispose)},x=e=>m(j(e.map(M)));var g=require("suchibot");var T=(e,{getDoc:t})=>(...o)=>Object.assign(()=>e(...o),{doc:t(...o)}),ae=e=>Object.assign(()=>x(e.map(o=>m(o()))),{doc:f.toStringArray(e)}),q=e=>{e.forEach(t=>t()),e.forEach(t=>f.print(t))},le=e=>q([e]);var D=e=>{let t=h(!1),o=()=>t.isEnabled,r=async i=>{for(;o();)e(),await(0,g.sleep)(i)},s=()=>t.disable();return{tick:({delayMs:i=50}={})=>{o()&&s(),t.enable(),r(i)},onTickStart:i=>{let c=t.listen(K=>{K&&i()});return m(c)},onTickRelease:i=>{let c=t.listen(K=>{K||i()});return m(c)},releaseTick:s,isTicked:o}};var u=require("suchibot");var Q=({onDown:e,onUp:t,hold:o,release:r})=>({onToggleEnabled:(s,{initialEnabled:n=!1,onDisable:l}={})=>{let p=h(n);return e(i=>(p.toggle(),p.isEnabled?s(p,i):l?.(p,i)))},onHold:(s,{onDisable:n}={})=>{let l=h(!1);return x([e(p=>{l.isEnabled||(l.enable(),s(l,p))}),t(p=>{l.disable(),n?.(l,p)})])},holdOnTime:async s=>{o(),await I.delayed(s),r()}}),pe=e=>{let t=()=>u.Keyboard.tap(e),o=l=>u.Keyboard.onDown(e,p=>l(p.modifierKeys)),r=l=>u.Keyboard.onUp(e,p=>l(p.modifierKeys)),s=()=>u.Keyboard.hold(e),n=()=>u.Keyboard.release(e);return{isDown:()=>u.Keyboard.isDown(e),isUp:()=>u.Keyboard.isUp(e),onDown:o,onUp:r,tap:t,hold:s,release:n,get value(){return e},...D(t),...Q({hold:s,release:n,onDown:o,onUp:r}),type:"keyboard",toString:()=>`${e}`}},ce=e=>{let t=()=>u.Mouse.click(e),o=l=>u.Mouse.onDown(e,p=>l(p.modifierKeys)),r=l=>u.Mouse.onUp(e,p=>l(p.modifierKeys)),s=()=>u.Mouse.hold(e),n=()=>u.Mouse.release(e);return{isDown:()=>u.Mouse.isDown(e),isUp:()=>u.Mouse.isUp(e),onDown:o,onUp:r,tap:t,hold:s,release:n,get value(){return e},onClick:l=>u.Mouse.onClick(e,l),doubleClick:()=>u.Mouse.doubleClick(e),...D(t),...Q({hold:s,release:n,onDown:o,onUp:r}),type:"mouse",toString:()=>`${e} (mouse)`}},_e={alt:!1,control:!1,shift:!1,super:!1,windows:!1,command:!1,meta:!1,leftAlt:!1,leftControl:!1,leftShift:!1,leftSuper:!1,leftWindows:!1,leftCommand:!1,leftMeta:!1,rightAlt:!1,rightControl:!1,rightShift:!1,rightSuper:!1,rightWindows:!1,rightCommand:!1,rightMeta:!1},ye=e=>{if(e.length<=0)throw new Error("Empty key sequence");let t=()=>e.forEach(i=>i.tap()),o=()=>e.forEach(i=>i.hold()),r=()=>e.forEach(i=>i.release()),s=(i,c,K)=>{let a=e[0],y=e.slice(1);if(y.length==0)return c(a);let E=S(),Me=K(a,y,E);return x([...Me,m(E.listen(We=>{We&&i(_e)}))])},n=i=>s(i,c=>c.onDown(i),(c,K,a)=>[c.onDown(()=>{a.notify(K.every(y=>y.isDown))}),c.onUp(()=>{a.notify(!1)})]),l=i=>s(i,c=>c.onUp(i),(c,K,a)=>[c.onDown(()=>{a.notify(!1)}),c.onUp(()=>{a.notify(K.every(y=>y.isDown))})]),p=()=>e.map(i=>i.value).join(" + ");return{isDown:()=>e.every(i=>i.isDown()),isUp:()=>e.every(i=>i.isUp()),onDown:n,onUp:l,tap:t,hold:o,release:r,get value(){return p()},...D(t),...Q({hold:o,release:r,onDown:n,onUp:l}),type:"keyboard",toString:()=>`${p()}`}};var ue=require("suchibot");var R=(o=>(o[o.up=1]="up",o[o.down=-1]="down",o))(R||{}),G=100,de=({step:e=G,direction:t})=>{let o=S(),r=()=>{ue.Mouse.scroll({y:e*t}),o.notify()};return{step:e,direction:t,tap:r,...D(r),toString:()=>`${R[t]} (scroll)`}},fe=(e=G)=>de({step:e,direction:-1}),me=(e=G)=>de({step:e,direction:1});var Ke=(()=>{let e={};return Object.entries(_).forEach(([t,o])=>e[t]=pe(o)),e})(),he=(()=>{let e={};return Object.entries(H).forEach(([t,o])=>e[t]=ce(o)),e})(),xe=ye,Te={UP:me,DOWN:fe};var W=require("suchibot"),Se=(()=>{let e=()=>W.Mouse.getPosition(),t=({x:r,y:s})=>{if(r!=null&&s!=null)return W.Mouse.moveTo(r,s);let n=e();return W.Mouse.moveTo(r??n.x,s??n.y)};return{move:({x:r,y:s})=>{let n=e();return t({x:n.x+(r??0),y:n.y+(s??0)})},moveTo:t,getPosition:e,onMove:r=>W.Mouse.onMove(s=>r({x:s.x,y:s.y},s.modifierKeys,s))}})();var z=({when:e,then:t})=>e.onToggleEnabled(()=>{t.hold()},{onDisable:()=>{t.release()}}),be=T(z,{getDoc:e=>f.holdKey(e)});var J=({when:e,then:t})=>e.onDown(()=>t.tap()),ge=T(J,{getDoc:e=>f.tapKey(e)});var N=({initial:e=!1,key:t})=>{let o=h(e);return t.onDown(()=>o.toggle()),o};var X=({when:e,then:t,delayMs:o=50})=>e.onToggleEnabled(()=>t.tick({delayMs:o}),{onDisable:()=>t.releaseTick()}),Pe=T(X,{getDoc:e=>f.tickKey(e)}),Ie=T(({when:e,then:t,activate:o})=>{let r=N({key:o});return x([m(r.listen(s=>{s||t.releaseTick()})),e.onHold(()=>{r.isEnabled&&t.tick()},{onDisable:()=>t.releaseTick()})])},{getDoc:({when:e,then:t,activate:o})=>[`When ${f.tap(o)}, then activate script`,"",`When ${f.hold(e)}, then ${f.hold(t)}`]});var ve=100,De=async({needContinue:e,execute:t,delayMs:o=ve})=>{let r=1;for(;e(r);)t(),await(0,g.sleep)(o),r++},we=async({needContinue:e,execute:t,delayMs:o=ve})=>{let r=1;for(;e(r);)await t(),await(0,g.sleep)(o),r++};0&&(module.exports={BoolState,BoolStateCompose,Cast,Cursor,DisposeWrapper,DocUtils,Key,KeysSequence,MouseKey,Observable,PromiseUtils,Queue,Rx,ScrollDirection,ScrollKey,StringUtils,SuchKey,SuchMouseKey,combineDisposers,combineListeners,combineScriptsWithDoc,createTimer,createTimerSequence,force,getHoldKey,getTapKey,getTickByHold,getTickKey,holdKey,inOfAny,runScript,runScripts,sleep,stream,tapKey,tickKey,toDisposer,toListener,toggleStateByTap,whileNeed,whileNeedAsync,wrapToScriptWithDoc});
